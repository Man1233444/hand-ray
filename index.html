<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Pose Sanity Test</title>

<script src="https://cdn.jsdelivr.net/npm/@mediapipe/pose/pose.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>

<style>
html,body{
  margin:0;
  width:100%;
  height:100%;
  background:black;
  overflow:hidden;
}
video,canvas{
  position:absolute;
  width:100%;
  height:100%;
  object-fit:cover;
}
#msg{
  position:fixed;
  top:10px;
  left:10px;
  color:white;
  font-size:16px;
  background:rgba(0,0,0,.5);
  padding:6px;
}
</style>
</head>
<body>

<video id="video" autoplay playsinline></video>
<canvas id="canvas"></canvas>
<div id="msg">waitingâ€¦</div>

<script>
const video = document.getElementById("video");
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");
const msg = document.getElementById("msg");

canvas.width = innerWidth;
canvas.height = innerHeight;

const pose = new Pose({
  locateFile: f => `https://cdn.jsdelivr.net/npm/@mediapipe/pose/${f}`
});

pose.setOptions({
  modelComplexity: 0,
  smoothLandmarks: true,
  minDetectionConfidence: 0.5,
  minTrackingConfidence: 0.5
});

pose.onResults(r=>{
  ctx.clearRect(0,0,canvas.width,canvas.height);

  if(!r.poseLandmarks){
    msg.textContent = "NO LANDMARKS";
    return;
  }

  msg.textContent = "TRACKING";

  // left & right wrist
  [15,16].forEach(i=>{
    const p = r.poseLandmarks[i];
    if(!p) return;
    ctx.beginPath();
    ctx.arc(p.x*canvas.width,p.y*canvas.height,20,0,Math.PI*2);
    ctx.fillStyle="lime";
    ctx.fill();
  });
});

const cam = new Camera(video,{
  onFrame: async()=>{ await pose.send({image:video}); },
  width:1280,
  height:720,
  facingMode:"environment"
});
cam.start();
</script>

</body>
</html>
